<%- include('includes/header') %>
<title>Heimursaga | Password Reset</title>

</head>

<body data-theme="default" data-layout="fluid" data-sidebar-position="left" data-sidebar-behavior="sticky">
	<div class="main d-flex justify-content-center w-100">
		<main class="content d-flex p-0">
			<div class="container d-flex flex-column">
				<div class="row h-100">
					<div class="col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100">
						<div class="d-table-cell align-middle">

							<div class="text-center mb-4 me-4">
								<img src="./img/brands/Heimursaga Logo & Slogan Brown white-bg.svg" width="280" height="105" alt="Heimursaga">
							</div>

							<div class="card">
								<div class="card-body">
									<%- include('includes/flash') %>
									<div class="text-center mt-2 mb-4">
										<h1 class="h3">Password Reset</h1>
									</div>
									<div class="m-sm-3">
											<form action="/reset-password/<%= user.resetPasswordToken %>" method="POST">

												<div class="mb-3">
													<input type="email" class="form-control" id="email-register" name="email" value="<%= user.email %>" hidden>
												</div>

												<div class="mb-3">

													<style>
														.form-item {
															position: relative;
															}
	
														.fas-eye {
															position: absolute;
															right: 1.1rem;
															top: 0.8rem;
															cursor: pointer;
															}
													</style>
													<label class="form-label">New Password</label>
													<div class="form-item">
														<input type="password" name="PasswordNew" class="form-control form-control-lg" id="PasswordNew" maxlength="50" minlength="8"/>
														<i class="fas-eye fas fa-eye" id="eye"></i>
													  </div>
	
												</div>
												<div class="mb-5">
													<label class="form-label">Confirm Password</label>
														<input class="form-control form-control-lg" type="password" name="confirm_password" id="confirm_password"/>
														<span id='message'></span>
												</div>
												
												<div class="text-center mt-3">

													<input type="hidden" name="_csrf" value="<%= csrfToken %>">

													<button id="submit" type="submit" class="btn btn-lg btn-primary">Submit</button>
												</div>
											</form>
									</div>

								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<script src="js/app.js"></script>
	<script>
		const password = document.querySelector("#PasswordNew");
		const confirmpassword = document.querySelector("#confirm_password");
		const eyeIcon = document.querySelector("#eye");
		const submit = document.querySelector("#submit")

		eyeIcon.addEventListener("click", () => {
		if (eyeIcon.classList.contains("fa-eye")) {
			password.setAttribute("type", "text");
			confirmpassword.setAttribute("type", "text")
			eyeIcon.classList.replace("fa-eye", "fa-eye-slash");
		} else {
			password.setAttribute("type", "password");
			confirmpassword.setAttribute("type", "password")
			eyeIcon.classList.replace("fa-eye-slash", "fa-eye");
		}
		});

		$('#PasswordNew, #confirm_password').on('keyup', function () {
		if ($('#PasswordNew').val() == $('#confirm_password').val()) {
			submit.removeAttribute("disabled");
		} else 
			submit.setAttribute("disabled", true);
		});

		$('#PasswordNew, #confirm_password').on('keyup', function () {
		if ($('#PasswordNew').val() == $('#confirm_password').val()) {
			$('#message').html('Matching').css('color', 'green');
		} else 
			$('#message').html('Not Matching').css('color', 'red');
		});
	</script>

</body>

</html>