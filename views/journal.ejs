<%- include('includes/header') %>

<title>Heimursaga | Journal - <%= profileUsername %></title>

<meta property="og:image" content="<%= profileAvatar %>" />
<meta name="description" content="<% if (bio == "undefined") { %>
	<i>This explorer has not yet added a bio</i>
	<% } else { %>
		<%= bio %>
	<% } %>
">

</head>

<%- include('includes/sidebar') %>

<%- include('includes/navbar') %>

			<main class="content">
				<div class="container-fluid p-0">

					<div class="row">
						<% if (isVisitorsProfile) { %>
							<h3 class="text-center d-lg-none pb-3">My Journal</h3>
						<% } %>
						<%- include('includes/flash') %>
					  <div class="">
						  <div class="container-fluid p-0">
							<!--<div class="card" style="height: 40px; background-color: #3C73AA;">
								where are you
							</div>-->
							<div class="row">
							  <div class="col-12 col-lg-3 d-flex">
								<div class="card flex-fill overflow-auto" style="height: 80vh;">

									<% if (user && isVisitorsProfile) { %>
										<div class="card-header pb-0">
											<div class="card-actions float-end">
												<div class="dropdown show">
													<a href="#" data-bs-toggle="dropdown" data-bs-display="static">
                 									 <i class="align-middle" data-feather="more-horizontal"></i>
                									</a>

													<div class="dropdown-menu dropdown-menu-end text-center">
														<a class="dropdown-item" href="/settings/<%= profileUsername %>">Edit Profile</a>
													</div>
												</div>
											</div>
										</div>
									<% } %>

									<div class="card-body text-center mt-2">
										<% if (type == "ExplorerPro") { %>
										<img src="<%= profileAvatar %>" class="img-fluid rounded-circle border border-primary mb-2" style="border-width: 3px !important;" width="128" height="128" />
										<% } else { %>
										<img src="<%= profileAvatar %>" class="img-fluid rounded-circle mb-3" width="128" height="128" />
										<% } %>

										<h5 class="card-title mb-4 profile-username"><%= profileUsername %></h5>
										<!--<div class="text-muted mb-2"><%= type %></div>-->

										<% if (user && !isVisitorsProfile) { %>

											<div class="text center" style="margin-bottom: -30px;">

												<input type="hidden" id="is-following" class="is-following" value="<%= isFollowing %>">
												<input type="hidden" id="entry-username" class="entry-username" value="<%= profileUsername %>">
									  

											<% if (isFollowing) { %>


												<button id="follow-button" style="border: none; background: transparent;" class="text-primary">
												  <i id="icon-heimursaga-follow-alt-2" style="font-size: x-large; color: #AC6D46;" class="icon-heimursaga-follow-alt-2"></i>
												  <div class="w-100"></div>
												  <i id="follow-check" class="follow-check" style="color: #AC6D46; width: 12; height: 12; margin-top: -12px;" data-feather="check"></i>
												</button>
										
												<% } else { %>
										
												<button id="follow-button" style="border: none; background: transparent;" class="text-blue">
												  <i id="icon-heimursaga-follow-alt-2" style="font-size: x-large; color: #3C73AA;" class="icon-heimursaga-follow-alt-2"></i>
												  <div class="w-100"></div>
												  <i id="follow-check" class="follow-check" style="color: white; width: 12; height: 12; margin-top: -12px;" data-feather="check"></i>
												</button>

										
											<% } %>

												<button id="fund-button" style="border: none; background: transparent;" class="text-blue" disabled>
													<i id="icon-heimursaga-fund-alt" style="font-size: x-large; color: #adb5bd;" class="icon-heimursaga-fund-alt"></i>
													<div class="w-100"></div>
													<i id="follow-check" class="fund-check" style="color: white; width: 12; height: 12; margin-top: -12px;" data-feather="check"></i>
												</button>

												<button id="message-button" style="border: none; background: transparent;" class="text-blue" disabled>
													<i id="icon-heimursaga-message" style="font-size: x-large; color: #adb5bd;" class="icon-heimursaga-message"></i>
													<div class="w-100"></div>
													<i id="follow-check" class="message-check" style="color: white; width: 12; height: 12; margin-top: -12px;" data-feather="check"></i>
												</button>

											</div>

										<% } else { %>

											<div style="margin-bottom: -50px;"></div>

										<% } %>

										<% if (user && isVisitorsProfile) { %>

											<div style="margin-bottom: -50px;"></div>

										<% } %>
	

									</div>
									<hr class="my-0" />
									
									<div class="card-body">
										<% if (bio == "undefined" && isVisitorsProfile) { %>

											<a href="/settings/<%= profileUsername %>">Add Bio</a>

										<% } if (bio == "undefined" && !isVisitorsProfile) { %>

											<i>This explorer has not yet added a bio</i>

										<% } else { %>

											<% if (bio == "undefined") { %>


											<% } else { %>

												<%= bio %>

											<% } %>

										<% } %>

									</div>
									<hr class="my-0" />
									
									<div class="card-body">
										<ul class="list-unstyled mb-0">
											<li class="mb-1"><span data-feather="briefcase" class="feather-sm me-1"></span> Currently in <strong>										
											<% if (currentlyin == "undefined" && isVisitorsProfile) { %>

												<a href="/settings/<%= profileUsername %>">Add Location</a>
	
											<% } if (currentlyin == "undefined" && !isVisitorsProfile) { %>
	
												<i>unknown</i>
	
											<% } else { %>
	
												<% if (currentlyin == "undefined") { %>


													<% } else { %>
		
														<%= currentlyin %>
		
													<% } %>
	
											<% } %></strong></li>
											<li class="mb-1"><span data-feather="home" class="feather-sm me-1"></span> Lives in <strong>											
											<% if (livesin == "undefined" && isVisitorsProfile) { %>

												<a href="/settings/<%= profileUsername %>">Add Location</a>
	
											<% } if (livesin == "undefined" && !isVisitorsProfile) { %>
	
												<i>unknown</i>
	
											<% } else { %>
	
												<% if (livesin == "undefined") { %>


													<% } else { %>
		
														<%= livesin %>
		
													<% } %>
	
											<% } %></strong></li>
											<li class="mb-1"><span data-feather="map-pin" class="feather-sm me-1"></span> From <strong>											
											<% if (from == "undefined" && isVisitorsProfile) { %>

												<a href="/settings/<%= profileUsername %>">Add Location</a>
	
											<% } if (from == "undefined" && !isVisitorsProfile) { %>
	
												<i>unknown</i>
	
											<% } else { %>
	
												<% if (from == "undefined") { %>


													<% } else { %>
		
														<%= from %>
		
													<% } %>
	
											<% } %></strong></li>
										</ul>
									</div>
								</div>
							  </div>
							  
							  <div class="col-12 col-lg-6 d-flex">
								<div class="card flex-fill" style="height: 80vh;">

									<input type="hidden" name="_csrf" value="<%= csrfToken %>">

									<style>
										.mapboxgl-popup {
										max-width: 350px;
										font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
										}
									</style>
									<div id="journalmap" class="journalmap" style='width: 100%; height: 80vh;'></div>	
									<div id="start-geocoder" class="start-geocoder" style="display: none;"></div>							
								</div>
							  </div>

							<div class="col-12 col-lg-3 d-flex">
								<div class="card w-100" style="height: 80vh;">
									<div class="card-header p-0 mt-1 text-center">
										<ul class="nav nav-tabs card-header-tabs pull-right overflow-hidden justify-content-center pr-0 m-0" role="tablist">
											<li class="nav-item p-0">
												<a class="nav-link active text-primary" data-bs-toggle="tab" href="#tab-1"><i class="fas fa-feather-alt"></i></a>
											</li>

											<% if (user && isVisitorsProfile) { %>

											<li class="nav-item p-0">
												<a class="nav-link text-primary" data-bs-toggle="tab" href="#tab-2"><i class="fas fa-edit"></i></a>
											</li>

											<% } %>

											<li class="nav-item p-0">
												<a class="nav-link text-primary" data-bs-toggle="tab" href="#tab-3"><i class="fas fa-user-check"></i></a>
											</li>

											<% if (user && isVisitorsProfile) { %>

											<li class="nav-item p-0">
												<a class="nav-link text-primary" data-bs-toggle="tab" href="#tab-4"><i class="fas fa-users"></i></a>
											</li>
											
											<!--<li class="nav-item p-0">
												<a class="nav-link text-primary" data-bs-toggle="tab" href="#tab-5"><i class="fas fa-heart"></i></a>
											</li>-->

											<li class="nav-item p-0">
												<a class="nav-link text-primary" data-bs-toggle="tab" href="#tab-6"><i class="fas fa-bookmark"></i></a>
											</li>
											<% } %>

										</ul>
									</div>
									<div class="card-body overflow-auto">
										<div class="tab-content">
											<div class="tab-pane fade show active" id="tab-1" role="tabpanel">
												<h5 class="card-title text-center pb-2">Entries</h5>
												
												<div class="list-group list-group-flush">
													<% entries.forEach(function(entry) { %>
														<a data-bs-toggle="modal" href="#sizedModalMd-<%= entry._id %>" class="list-group-item list-group-item-action sizedModalMd">
															<% if (entry.privacy == "private") { %>
																<strong><%= entry.title %></strong><br/>
																<i class="align-middle me-0 fas fa-fw fa-lock text-blue"></i> <small class="align-middle"><%= entry.place %> | <%= entry.date %></small><br/>
																<small>by <strong><%= entry.author.username %></strong></small>	
															<% } else { %>
															<strong><%= entry.title %></strong><br/>
															<i class="align-middle me-0 fas fa-fw fa-map-marker-alt text-primary"></i> <small class="align-middle"><%= entry.place %> | <%= entry.date %></small><br/>
															<small>by <strong><%= entry.author.username %></strong></small>
															<% } %>
															</a>
																<div class="modal fade" id="sizedModalMd-<%= entry._id %>" data-bs-target="#sizedModalMd" data-bs-whatever="<%= entry._id %>" tabindex="-1" role="dialog" aria-hidden="true">
																	<div class="modal-dialog modal-md modal-dialog-centered" role="document">
																		<div class="modal-content">
																			<div class="modal-body mb-0">
																				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
																			</div>
																			<div class="modal-body mt-0 pb-0">
																				<h4 class="text-center"><%= entry.title %></h4>
																			</div>
						
																			<div class="col-8 offset-2 mb-4">
																				<hr>
																			</div>
												  
																			<% if (entry.privacy == "private") { %>

																			<div class="modal-body col-md-8 offset-md-2 pb-0 pt-0 text-center">
																				<h5><i class="align-middle mr-5 fas fa-fw fa-lock text-blue"></i><%= entry.place %></h5>
																			</div>

																			<% } else { %>

																			<div class="modal-body col-md-8 offset-md-2 pb-0 pt-0 text-center">
																				<h5><i class="align-middle mr-5 fas fa-fw fa-map-marker-alt text-primary"></i><%= entry.place %></h5>
																			</div>

																			<% } %>


																  
																			<div class="modal-body col-md-8 offset-md-2 pt-0">
																				<h5 class="text-center text-muted">on <%= new Date(entry.date).toLocaleString('default', { month: 'long' }) %> <%= new Date(entry.date).getDate() %>, <%= new Date(entry.date).getFullYear() %> | by <a href="/journal/<%= entry.author.username %>"><%= entry.author.username %></a></h5>
																			</div>
												  
																			<div class="modal-body">
																			  <div class="text-center mb-1 overflow-hidden">
																				<img src="https://api.mapbox.com/styles/v1/cnh1187/ckwqyxju41h0c14o695dd3fdt/static/pin-s+ac6d46(<%=entry.GeoJSONcoordinates.coordinates%>)/<%=entry.GeoJSONcoordinates.coordinates%>,6/300x300?access_token=pk.eyJ1IjoiY25oMTE4NyIsImEiOiJja28wZTZpNGowY3RoMnBvaTgxZ2M5c3ljIn0.t3_T3EN00e5w7D0et4hf-w">
																			  </div>
																			  <div class="mb-4 text-center">
																				<small>Longitude: <%= entry.GeoJSONcoordinates.coordinates[0]%>, Latitude: <%= entry.GeoJSONcoordinates.coordinates[1]%></small>
																			  </div>
												  
												  
																			  <div class="modal-body mb-2">
																				<%- filterUserHTML(entry.body) %>
																			  </div>

																			  <% if (entry.hasPhoto) { %>

																			  <div id="photoDiv" class="photoDiv modal-body">
																				<img id="photo" src="https://f002.backblazeb2.com/file/heimursaga-entry-photos/<%= entry._id %>" class="photo img-fluid mb-3" alt="entry image">
																			  </div>

																			  <% } %>

																			</div>
						
																			<% if (user) { %>
						
																				<div class="">

																					<iframe src="button-stack/<%= entry._id %>" id="button-stack" width="100%" scrolling="no"></iframe>
														
																				  </div>
						
																			<% } %>
												  
												  
																			<div class="col-8 offset-2 mb-4">
																			  <hr>
																			</div>
												  
																			<div>
																			  <p class="text-muted small mb-4 text-center">
																			  <a href="/journal/<%= entry.author.username %>"><img class="avatar img-fluid rounded-circle me-1" src="<%= entry.author.avatar %>"></a>
																			  Posted on <%= entry.createdDate.getMonth() + 1 %>/<%= entry.createdDate.getDate() %>/<%= entry.createdDate.getFullYear() %></p>
																			</div> 
																			
																			<div class="text-center mb-4">
																				<small class="text-muted">
																				<a href="/entry/<%= entry._id %>">Visit entry permalink</a>
																				</small>
																			</div>


																			<div class="row text-center mb-1">

																				<% if (isVisitorsProfile) { %>
																				<div class="pb-4"
																				  <span class="pe-2">
																					<a href="/entry/<%= entry._id %>/edit" class="text-primary mr-2" data-toggle="tooltip" data-placement="top" title="Edit"><i class="fas fa-edit"></i></a>
																					<form onsubmit="return confirm('Are you sure you want to delete this entry? This action is irreversible.');" class="delete-post-form d-inline" action="/entry/<%= entry._id %>/delete" method="POST">
																					
																					<input type="hidden" name="_csrf" value="<%= csrfToken %>">
																  
																					<button class="btn text-danger" data-toggle="tooltip" data-placement="top" title="Delete"><i class="fas fa-trash-alt"></i></button>
																					</form>
																				  </span>
																				</div>

																				  <% } else { %>
													
																					<div class="">
													  
																						<iframe src="flag-button/<%= entry._id %>" id="flag-button" height="60" scrolling="no"></iframe>
													  
																					</div>
													
																				  <% } %>
																  
																			</div>

																			<div class="modal-body m-0">
																				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
																				<!--<button type="button" class="btn btn-default btn-prev">Prev</button>
																				<button type="button" class="btn btn-default btn-next">Next</button>-->
																			</div>

						
																		</div>
																	</div>
																</div>
												   	<% }) %>
												</div>
											</div>

											<div class="tab-pane fade" id="tab-2" role="tabpanel">
												<h5 class="card-title text-center pb-2">Drafts</h5>
												<div class="list-group list-group-flush">
												<% drafts.forEach(function(draft) { %>
													<a href="/draft/<%= draft._id %>/edit" class="list-group-item list-group-item-action">
														<strong><%= draft.title %></strong><br/>
														<i class="align-middle me-0 fas fa-fw fa-map-marker-alt text-primary"></i> <small class="align-middle"><%= draft.place %> | <%= draft.date %></small>
													  </a>
												 <% }) %>
												</div>
											</div>

											<div class="tab-pane fade" id="tab-3" role="tabpanel">
												<h5 class="card-title text-center pb-2">Following</h5>
												<div class="list-group list-group-flush">
												<% following.forEach(function(followedUser) { %>
													<a href="/journal/<%= followedUser.username %>" class="list-group-item list-group-item-action p-3">
													  <img class="avatar img-fluid rounded-circle me-2" src="<%= followedUser.avatar %>">
													  <%= followedUser.username %>
													</a>
												 <% }) %>
												</div>
											</div>

											<% if (user && isVisitorsProfile) { %>

											<div class="tab-pane fade" id="tab-4" role="tabpanel">
												<h5 class="card-title text-center pb-2">Followers</h5>
												<div class="list-group list-group-flush">
												<% followers.forEach(function(follower) { %>
													<a href="/journal/<%= follower.username %>" class="list-group-item list-group-item-action p-3">
													  <img class="avatar img-fluid rounded-circle me-1" src="<%= follower.avatar %>">
													  <%= follower.username %>
													</a>
												 <% }) %>
												</div>
											</div>
											
											<!--<div class="tab-pane fade" id="tab-5" role="tabpanel">
												<h5 class="card-title text-center pb-2">Highlights</h5>
												<div class="list-group list-group-flush">
													<% highlighted.forEach(function(highlightedEntry) { %>
														<a href="/entry/<%= highlightedEntry.id %>" class="list-group-item list-group-item-action">
														  <strong><%= highlightedEntry.title %></strong><br/>
														  <i class="align-middle me-0 fas fa-fw fa-map-marker-alt text-primary"></i> <small class="align-middle"><%= highlightedEntry.place %> | <%= highlightedEntry.date %></small>
														</a>
													 <% }) %>
												</div>
											</div>-->

											<div class="tab-pane fade" id="tab-6" role="tabpanel">
												<h5 class="card-title text-center pb-2">Bookmarks</h5>
												<div class="list-group list-group-flush">
													<% bookmarked.forEach(function(bookmarkedEntry) { %>
														<a href="/entry/<%= bookmarkedEntry.id %>" class="list-group-item list-group-item-action">
														  <strong><%= bookmarkedEntry.title %></strong><br/>
														  <i class="align-middle me-0 fas fa-fw fa-map-marker-alt text-primary"></i> <small class="align-middle"><%= bookmarkedEntry.place %> | <%= bookmarkedEntry.date %></small>
														</a>
													 <% }) %>
												</div>
											</div>

											<% } %>
										</div>
									</div>
								</div>
							</div>

						  </div>
						</div>
					  </div>
					</div>
		
			</main>

			<script>



			</script>
						

			
<%- include('includes/footer') %>